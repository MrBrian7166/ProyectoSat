
  






  
<!DOCTYPE html>
<html>
	<head>
	<!-- https://bugzilla.novell.com/show_bug.cgi?id=997951,for Kerberos in IE 11, we need to put idp under local intranet site.
	A Local intranet site is displayed in Compatibility View by default by IE. In compatibilty mode advanced latest jquery or javascript
	libraries do not work. So we need to force browser to run in non-compatibility mode. For, this 
	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=Edge">
	should be the first statement in your html. so, 
	*****NOTE ****DONOT add any other meta tag before X-UA-Compatible. Other tags cab be added after this tag
	 --> 
	    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=Edge">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title></title>
		<noscript>
			<div  style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
				Your web browser must have JavaScript enabled in order for this application to display correctly.
		    </div>
		    <style type="text/css">
		    	#reconContent { display:none; }
		    </style>
        </noscript>
	</head>
	<body >
	<div id="reconContent">
	    <form name="recon" id="deviceRecon" action ="https://login.mat.sat.gob.mx/nidp//app/login?id=contr-dual-eFirma-totp&sid=1&option=credential&sid=1&target=https%3A%2F%2Flogin.mat.sat.gob.mx%2Fnidp%2Foauth%2Fnam%2Fauthz%3Fclient_id%3D50bffab8-793c-41c4-b639-9abe2a93cb2c%26redirect_uri%3Dhttps%3A%2F%2Fptsc32d.clouda.sat.gob.mx%3A443%2Foauth2%2Fcallback%26response_type%3Dcode%26scope%3Dopenid%2Bmscontribuyente%26code_challenge_method%3DS256%26response_mode%3Dform_post" method="POST">
	    	<input type="hidden" name="deviceAttributes" id="deviceAttributes" value="">
	    	<input type="hidden" name="fingerprint" id="fingerprint" value="">
	    	<input type="hidden" name="deviceFetchGuidance" id="deviceFetchGuidance" value="">
	    	<input type="hidden" name="innerCall" id="innerCall" value="true">
	    	<input type="hidden" name="rid" id="rid" value="1">
	    	<input type="hidden" name="firstTimeFingerprint" id="firstTimeFingerprint" value="true">  
	    </form>
	    <script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/min/fontDetect.min.js"></script> 
		<script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/min/modernizr-nam.min.js"></script>
		<script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/min/namFingerprint.min.js"></script> 
		<script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/min/ua-parser.min.js"></script>
		<script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/min/storage.min.js"></script>
		<script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/min/crypto.min.js"></script>
		<script type="text/javascript" src="/nidp/javascript/deviceFingerprinting/node-jose/dist/node-jose.min.js"></script>
		<script>
			function doRecon(){
				if ( true ) 
					setks();
				this.document.recon.deviceAttributes.value = calculateFreshFingerprint( 'deviceType, deviceLanguage_deviceDefaultLanguage, userAgent_uaVersion, cpuArchitecture_cpuArchitecture, dnt, operatingSystem_osVersion, deviceLanguage_deviceLanguageSet, userAgent_uaName, navigatorConcurrency, deviceTouchSupport, timezoneOffset, deviceTouchPoints, navigatorPlatform_navigatorPlatform, colorDepth, operatingSystem_osName,userAgent_uaString');
				if(false){
					this.document.recon.fingerprint.value = fetchFingerprint();
				}else{
					if(false){
						this.document.recon.deviceFetchGuidance.value = getDeviceFetchGuidance( '');
					}
				}
				submitForm();
			}
			
			function fetchFingerprint(){
				var dfp = read('');
				return dfp;
			}
			
			function setks(){
				clearStorage('_dreanskasjeaidp');
				var json = JSON.parse('{"kty":"oct","use":"sig","alg":"HS256","k":"s0d+YJQ6ZK4W+Cmhm4DIgnRwFKnMIEemOwPwU0ZRUKk="}');
				var s = "'" + json.k + "'";
				json = JSON.parse('{"kty":"oct","use":"enc","alg":"A128CBC-HS256","k":"J/URsnQ53AU6BdrbIxl/X9ewlWkui93HJJRMtvVGOwk="}');
				var k = "'" + json.k + "'";
				 if(typeof console !== "undefined")
				{
					console.log ("setting key " + s );
					console.log ("setting key " + k );
				}
				write('254398_dreanskasjeaidp',s);
				write('321432_dreanskasjeaidp',k);
			}

			function calculateFreshFingerprint(attributeNames){
				var attributeArray = attributeNames.split(',');
				return getFingerprint(attributeArray, '1765177933963');
			}
			
			function submitForm(){
				if ( true || false || true ){
					getFingerprintSignedEnc(this.document.recon.deviceAttributes.value, '{"kty":"oct","use":"sig","alg":"HS256","k":"s0d+YJQ6ZK4W+Cmhm4DIgnRwFKnMIEemOwPwU0ZRUKk="}', '{"kty":"oct","use":"enc","alg":"A128CBC-HS256","k":"J/URsnQ53AU6BdrbIxl/X9ewlWkui93HJJRMtvVGOwk="}');
				}else {
					var s = read('254398_dreanskasjeaidp');
					var e = read('321432_dreanskasjeaidp');
					var sk = "{ \"kty\":\"oct\", \"use\":\"sig\", \"alg\":\"HS256\",\"k\":\"" + s + "\" }";
					//console.log (sk );
					var ek = "{ \"kty\":\"oct\", \"use\":\"enc\", \"alg\":\"A128CBC-HS256\",\"k\":\"" + e + "\" }";
					getFingerprintSignedEnc(this.document.recon.deviceAttributes.value, sk, ek);
				}
			}
			
			doRecon();
			
		</script>
		</div>
	</body>
</html>

